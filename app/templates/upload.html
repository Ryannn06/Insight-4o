{% extends 'base.html'%}
{% block title %}Upload{% endblock %}


{% block content %}
<div class="block-content d-flex justify-content-center mt-3">
    <div class="card card-drop bg-dark text-light">
        <h2 class="mb-3">Upload a File</h2>
        <div class="drop_box">
            <header>
                <h4>Select a File here</h4>
            </header>
            <p class="form-label text-muted">Files Supported: CSV, XLSX</p>
            <input type="file" hidden accept=".csv,.xlsx" id="fileID" style="display:none;">
            <button class="btn btn-secondary">
                Choose a file <i class="bi bi-file-earmark-text"></i>
            </button>
        </div>
    </div>
</div>

{% block script %}
<script>
    const dropArea = document.querySelector(".drop_box"),
        button = dropArea.querySelector("button"),
        dragText = dropArea.querySelector("header"),
        input = dropArea.querySelector("input");
    let file;
    var filename;

    button.onclick = () => {
        input.click();
    };

    input.addEventListener("change", function (e) {
        const file = e.target.files[0];
            if (!file) return;
            var fileName = file.name;
            let filedata = `
                <form action="/upload/" method="post" enctype="multipart/form-data">
                <div class="form">
                <header>
                    <p>Selected file:</p>
                </header>
                <h5 class="text-muted mb-3">${fileName}</h5>
                <!-- keep the actual file input so it submits -->
                <input type="file" name="file" hidden>
                <button class="btn btn-secondary">Upload <i class="bi bi-file-earmark-arrow-up"></i></button>
                </div>
                </form>`;

            dropArea.innerHTML = filedata;

        // Append the selected file to the hidden input so it actually submits
        const newInput = dropArea.querySelector("input[type=file]");
        const dataTransfer = new DataTransfer(); // create a DataTransfer to hold the file
        dataTransfer.items.add(file);
        newInput.files = dataTransfer.files;
    });

</script>
{% endblock %}
{% endblock%}